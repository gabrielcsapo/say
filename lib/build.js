var fs = require('fs');
var path = require('path');
var async = require('async');
var gm = require('gm');

var alphabet_upper = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
var alphabet_lower = [ 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
var emoji = ["ğŸŒ€","ğŸŒ","ğŸŒ‚","ğŸŒƒ","ğŸŒ„","ğŸŒ…","ğŸŒ†","ğŸŒ‡","ğŸŒˆ","ğŸŒ‰","ğŸŒŠ","ğŸŒ‹","ğŸŒŒ","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ","ğŸŒ‘","ğŸŒ’","ğŸŒ“","ğŸŒ”","ğŸŒ•","ğŸŒ–","ğŸŒ—","ğŸŒ˜","ğŸŒ™","ğŸŒš","ğŸŒ›","ğŸŒœ","ğŸŒ","ğŸŒ","ğŸŒŸ","ğŸŒ ","ğŸŒ¡","ğŸŒ¤","ğŸŒ¥","ğŸŒ¦","ğŸŒ§","ğŸŒ¨","ğŸŒ©","ğŸŒª","ğŸŒ«","ğŸŒ¬","ğŸŒ­","ğŸŒ®","ğŸŒ¯","ğŸŒ°","ğŸŒ±","ğŸŒ²","ğŸŒ³","ğŸŒ´","ğŸŒµ","ğŸŒ¶","ğŸŒ·","ğŸŒ¸","ğŸŒ¹","ğŸŒº","ğŸŒ»","ğŸŒ¼","ğŸŒ½","ğŸŒ¾","ğŸŒ¿","ğŸ€","ğŸ","ğŸ‚","ğŸƒ","ğŸ„","ğŸ…","ğŸ†","ğŸ‡","ğŸˆ","ğŸ‰","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ","ğŸ","ğŸ","ğŸ","ğŸ‘","ğŸ’","ğŸ“","ğŸ”","ğŸ•","ğŸ–","ğŸ—","ğŸ˜","ğŸ™","ğŸš","ğŸ›","ğŸœ","ğŸ","ğŸ","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ°","ğŸ±","ğŸ²","ğŸ³","ğŸ´","ğŸµ","ğŸ¶","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¼","ğŸ½","ğŸ¾","ğŸ¿","ğŸ€","ğŸ","ğŸ‚","ğŸƒ","ğŸ„","ğŸ…","ğŸ†","ğŸ‡","ğŸˆ","ğŸ‰","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ","ğŸ","ğŸ","ğŸ","ğŸ‘","ğŸ’","ğŸ“","ğŸ–","ğŸ—","ğŸ™","ğŸš","ğŸ›","ğŸ","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ°","ğŸ±","ğŸ²","ğŸ³","ğŸ´","ğŸµ","ğŸ¶","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¼","ğŸ½","ğŸ¾","ğŸ¿","ğŸ€","ğŸ","ğŸ‚","ğŸƒ","ğŸ„","ğŸ…","ğŸ†","ğŸ‡","ğŸˆ","ğŸ‰","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ","ğŸ","ğŸ","ğŸ","ğŸ‘","ğŸ’","ğŸ“","ğŸ”","ğŸ•","ğŸ–","ğŸ—","ğŸ˜","ğŸ™","ğŸš","ğŸ›","ğŸœ","ğŸ","ğŸ","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ°","ğŸ³","ğŸ´","ğŸµ","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¼","ğŸ½","ğŸ¾","ğŸ¿","ğŸ€","ğŸ","ğŸ‚","ğŸƒ","ğŸ„","ğŸ…","ğŸ†","ğŸ‡","ğŸˆ","ğŸ‰","ğŸŠ","ğŸ‹","ğŸŒ","ğŸ","ğŸ","ğŸ","ğŸ","ğŸ‘","ğŸ’","ğŸ“","ğŸ”","ğŸ•","ğŸ–","ğŸ—","ğŸ˜","ğŸ™","ğŸš","ğŸ›","ğŸœ","ğŸ","ğŸ","ğŸŸ","ğŸ ","ğŸ¡","ğŸ¢","ğŸ£","ğŸ¤","ğŸ¥","ğŸ¦","ğŸ§","ğŸ¨","ğŸ©","ğŸª","ğŸ«","ğŸ¬","ğŸ­","ğŸ®","ğŸ¯","ğŸ°","ğŸ±","ğŸ²","ğŸ³","ğŸ´","ğŸµ","ğŸ¶","ğŸ·","ğŸ¸","ğŸ¹","ğŸº","ğŸ»","ğŸ¼","ğŸ½","ğŸ¾","ğŸ¿","ğŸ‘€","ğŸ‘","ğŸ‘‚","ğŸ‘ƒ","ğŸ‘„","ğŸ‘…","ğŸ‘†","ğŸ‘‡","ğŸ‘ˆ","ğŸ‘‰","ğŸ‘Š","ğŸ‘‹","ğŸ‘Œ","ğŸ‘","ğŸ‘","ğŸ‘","ğŸ‘","ğŸ‘‘","ğŸ‘’","ğŸ‘“","ğŸ‘”","ğŸ‘•","ğŸ‘–","ğŸ‘—","ğŸ‘˜","ğŸ‘™","ğŸ‘š","ğŸ‘›","ğŸ‘œ","ğŸ‘","ğŸ‘","ğŸ‘Ÿ","ğŸ‘ ","ğŸ‘¡","ğŸ‘¢","ğŸ‘£","ğŸ‘¤","ğŸ‘¥","ğŸ‘¦","ğŸ‘§","ğŸ‘¨","ğŸ‘©","ğŸ‘ª","ğŸ‘«","ğŸ‘¬","ğŸ‘­","ğŸ‘®","ğŸ‘¯","ğŸ‘°","ğŸ‘±","ğŸ‘²","ğŸ‘³","ğŸ‘´","ğŸ‘µ","ğŸ‘¶","ğŸ‘·","ğŸ‘¸","ğŸ‘¹","ğŸ‘º","ğŸ‘»","ğŸ‘¼","ğŸ‘½","ğŸ‘¾","ğŸ‘¿","ğŸ’€","ğŸ’","ğŸ’‚","ğŸ’ƒ","ğŸ’„","ğŸ’…","ğŸ’†","ğŸ’‡","ğŸ’ˆ","ğŸ’‰","ğŸ’Š","ğŸ’‹","ğŸ’Œ","ğŸ’","ğŸ’","ğŸ’","ğŸ’","ğŸ’‘","ğŸ’’","ğŸ’“","ğŸ’”","ğŸ’•","ğŸ’–","ğŸ’—","ğŸ’˜","ğŸ’™","ğŸ’š","ğŸ’›","ğŸ’œ","ğŸ’","ğŸ’","ğŸ’Ÿ","ğŸ’ ","ğŸ’¡","ğŸ’¢","ğŸ’£","ğŸ’¤","ğŸ’¥","ğŸ’¦","ğŸ’§","ğŸ’¨","ğŸ’©","ğŸ’ª","ğŸ’«","ğŸ’¬","ğŸ’­","ğŸ’®","ğŸ’¯","ğŸ’°","ğŸ’±","ğŸ’²","ğŸ’³","ğŸ’´","ğŸ’µ","ğŸ’¶","ğŸ’·","ğŸ’¸","ğŸ’¹","ğŸ’º","ğŸ’»","ğŸ’¼","ğŸ’½","ğŸ’¾","ğŸ’¿","ğŸ“€","ğŸ“","ğŸ“‚","ğŸ“ƒ","ğŸ“„","ğŸ“…","ğŸ“†","ğŸ“‡","ğŸ“ˆ","ğŸ“‰","ğŸ“Š","ğŸ“‹","ğŸ“Œ","ğŸ“","ğŸ“","ğŸ“","ğŸ“","ğŸ“‘","ğŸ“’","ğŸ““","ğŸ“”","ğŸ“•","ğŸ“–","ğŸ“—","ğŸ“˜","ğŸ“™","ğŸ“š","ğŸ“›","ğŸ“œ","ğŸ“","ğŸ“","ğŸ“Ÿ","ğŸ“ ","ğŸ“¡","ğŸ“¢","ğŸ“£","ğŸ“¤","ğŸ“¥","ğŸ“¦","ğŸ“§","ğŸ“¨","ğŸ“©","ğŸ“ª","ğŸ“«","ğŸ“¬","ğŸ“­","ğŸ“®","ğŸ“¯","ğŸ“°","ğŸ“±","ğŸ“²","ğŸ“³","ğŸ“´","ğŸ“µ","ğŸ“¶","ğŸ“·","ğŸ“¸","ğŸ“¹","ğŸ“º","ğŸ“»","ğŸ“¼","ğŸ“½","ğŸ“¿","ğŸ”€","ğŸ”","ğŸ”‚","ğŸ”ƒ","ğŸ”„","ğŸ”…","ğŸ”†","ğŸ”‡","ğŸ”ˆ","ğŸ”‰","ğŸ”Š","ğŸ”‹","ğŸ”Œ","ğŸ”","ğŸ”","ğŸ”","ğŸ”","ğŸ”‘","ğŸ”’","ğŸ”“","ğŸ””","ğŸ”•","ğŸ”–","ğŸ”—","ğŸ”˜","ğŸ”™","ğŸ”š","ğŸ”›","ğŸ”œ","ğŸ”","ğŸ”","ğŸ”Ÿ","ğŸ” ","ğŸ”¡","ğŸ”¢","ğŸ”£","ğŸ”¤","ğŸ”¥","ğŸ”¦","ğŸ”§","ğŸ”¨","ğŸ”©","ğŸ”ª","ğŸ”«","ğŸ”¬","ğŸ”­","ğŸ”®","ğŸ”¯","ğŸ”°","ğŸ”±","ğŸ”²","ğŸ”³","ğŸ”´","ğŸ”µ","ğŸ”¶","ğŸ”·","ğŸ”¸","ğŸ”¹","ğŸ”º","ğŸ”»","ğŸ”¼","ğŸ”½","ğŸ•‰","ğŸ•Š","ğŸ•‹","ğŸ•Œ","ğŸ•","ğŸ•","ğŸ•","ğŸ•‘","ğŸ•’","ğŸ•“","ğŸ•”","ğŸ••","ğŸ•–","ğŸ•—","ğŸ•˜","ğŸ•™","ğŸ•š","ğŸ•›","ğŸ•œ","ğŸ•","ğŸ•","ğŸ•Ÿ","ğŸ• ","ğŸ•¡","ğŸ•¢","ğŸ•£","ğŸ•¤","ğŸ•¥","ğŸ•¦","ğŸ•§","ğŸ•¯","ğŸ•°","ğŸ•³","ğŸ•´","ğŸ•µ","ğŸ•¶","ğŸ•·","ğŸ•¸","ğŸ•¹","ğŸ–‡","ğŸ–Š","ğŸ–‹","ğŸ–Œ","ğŸ–","ğŸ–","ğŸ–•","ğŸ––","ğŸ–¥","ğŸ–¨","ğŸ–±","ğŸ–²","ğŸ–¼","ğŸ—‚","ğŸ—ƒ","ğŸ—„","ğŸ—‘","ğŸ—’","ğŸ—“","ğŸ—œ","ğŸ—","ğŸ—","ğŸ—¡","ğŸ—£","ğŸ—¨","ğŸ—ª","ğŸ—¯","ğŸ—³","ğŸ—º","ğŸ—»","ğŸ—¼","ğŸ—½","ğŸ—¾","ğŸ—¿"];
var mathamatical_operators = ["@", "âˆ€", "âˆ", "âˆ‚", "âˆƒ", "âˆ„", "âˆ…", "âˆ†", "âˆ‡", "âˆˆ", "âˆ‰", "âˆŠ", "âˆ‹", "âˆŒ", "âˆ", "âˆ", "âˆ", "âˆ", "âˆ‘", "âˆ’", "âˆ“", "âˆ”", "âˆ•", "âˆ–", "âˆ—", "âˆ˜", "âˆ™", "âˆš", "âˆ›", "âˆœ", "âˆ", "âˆ", "âˆŸ", "âˆ ", "âˆ¡", "âˆ¢", "âˆ£", "âˆ¤", "âˆ¥", "âˆ¦", "âˆ§", "âˆ¨", "âˆ©", "âˆª", "âˆ«", "âˆ¬", "âˆ­", "âˆ®", "âˆ¯", "âˆ°", "âˆ±", "âˆ²", "âˆ³", "âˆ´", "âˆµ", "âˆ¶", "âˆ·", "âˆ¸", "âˆ¹", "âˆº", "âˆ»", "âˆ¼", "âˆ½", "âˆ¾", "âˆ¿", "â‰€", "â‰", "â‰‚", "â‰ƒ", "â‰„", "â‰…", "â‰†", "â‰‡", "â‰ˆ", "â‰‰", "â‰Š", "â‰‹", "â‰Œ", "â‰", "â‰", "â‰", , "â‰", "â‰‘", "â‰’", "â‰“", "â‰”", "â‰•", "â‰–", "â‰—", "â‰˜", "â‰™", "â‰š", "â‰›", "â‰œ", "â‰", "â‰", "â‰Ÿ", , "â‰ ", "â‰¡", "â‰¢", "â‰£", "â‰¤", "â‰¥", "â‰¦", "â‰§", "â‰¨", "â‰©", "â‰ª", "â‰«", "â‰¬", "â‰­", "â‰®", "â‰¯", , "â‰°", "â‰±", "â‰²", "â‰³", "â‰´", "â‰µ", "â‰¶", "â‰·", "â‰¸", "â‰¹", "â‰º", "â‰»", "â‰¼", "â‰½", "â‰¾", "â‰¿", , "âŠ€", "âŠ", "âŠ‚", "âŠƒ", "âŠ„", "âŠ…", "âŠ†", "âŠ‡", "âŠˆ", "âŠ‰", "âŠŠ", "âŠ‹", "âŠŒ", "âŠ", "âŠ", "âŠ", , "âŠ", "âŠ‘", "âŠ’", "âŠ“", "âŠ”", "âŠ•", "âŠ–", "âŠ—", "âŠ˜", "âŠ™", "âŠš", "âŠ›", "âŠœ", "âŠ", "âŠ", "âŠŸ", , "âŠ ", "âŠ¡", "âŠ¢", "âŠ£", "âŠ¤", "âŠ¥", "âŠ¦", "âŠ§", "âŠ¨", "âŠ©", "âŠª", "âŠ«", "âŠ¬", "âŠ­", "âŠ®", "âŠ¯", , "âŠ°", "âŠ±", "âŠ²", "âŠ³", "âŠ´", "âŠµ", "âŠ¶", "âŠ·", "âŠ¸", "âŠ¹", "âŠº", "âŠ»", "âŠ¼", "âŠ½", "âŠ¾", "âŠ¿", , "â‹€", "â‹", "â‹‚", "â‹ƒ", "â‹„", "â‹…", "â‹†", "â‹‡", "â‹ˆ", "â‹‰", "â‹Š", "â‹‹", "â‹Œ", "â‹", "â‹", "â‹", , "â‹", "â‹‘", "â‹’", "â‹“", "â‹”", "â‹•", "â‹–", "â‹—", "â‹˜", "â‹™", "â‹š", "â‹›", "â‹œ", "â‹", "â‹", "â‹Ÿ", , "â‹ ", "â‹¡", "â‹¢", "â‹£", "â‹¤", "â‹¥", "â‹¦", "â‹§", "â‹¨", "â‹©", "â‹ª", "â‹«", "â‹¬", "â‹­", "â‹®", "â‹¯", "â‹°", "â‹±", "â‹²", "â‹³", "â‹´", "â‹µ", "â‹¶", "â‹·", "â‹¸", "â‹¹", "â‹º", "â‹»", "â‹¼", "â‹½", "â‹¾", "â‹¿"]

var file = path.resolve('output', 'alphabet_lower', 'a' + '.png')
var file2 = path.resolve('output', 'mathamatical_operators', '@' + '.png')

var match = {};

var compare = function(file1, file2, letter, character, callback) {
    var _file1 = path.resolve('output', file1 + '.png')
    var _file2 = path.resolve('output', file2 + '.png')
    var options = {
      file: path.resolve('output', 'diff', letter + '-' + character + '.png'),
      highlightColor: 'yellow',
      tolerance: 0.02
    };
    gm.compare(_file1, _file2, options, function (err, isEqual, equality, raw, path1, path2) {
          if (equality <= 0.001377) {
            if(match[letter]) {
                match[letter].push(character);
            } else {
                match[letter] = [];
                match[letter].push(character);
            }
          }
          callback();
      });
}

var letter = 'a';
async.forEachOf(mathamatical_operators, function(operator, index, callback) {
    compare('alphabet_lower/' + letter, 'mathamatical_operators/' + operator, letter, operator, function() {
        callback();
    });
}, function() {
    console.log(match);
});


var rasterize = function(array, type, font, font_size, font_file) {
    async.forEachOf(array, function(value, index, callback) {
        try {
            var Canvas = require('canvas'),
                Image = Canvas.Image,
                Font = Canvas.Font,
                canvas = new Canvas(256, 256),
                ctx = canvas.getContext('2d');

            if(font) {
                // function fontFile(name) {
                //   return path.resolve(__dirname, '..', 'font', name);
                // }
                //
                // var FontFile = new Font(font, fontFile(font_file));
                // ctx.addFont(FontFile);
            }

            ctx.font = font ? font_size + " '"+font+"'" : "18px 'Arial Unicode MS'";
            var textWidth = ctx.measureText(value).width - 18;
            ctx.textBaseline="middle";
            ctx.textAlign = "center";
            ctx.fillText(value, canvas.width/2, canvas.height/2);

            var out = fs.createWriteStream(path.resolve('output', type, value + '.png'))

            var stream = canvas.pngStream();

            stream.on('data', function(chunk) {
                out.write(chunk);
            });

            stream.on('error', function(chunk) {
                console.log(chunk.toString('utf8'))
            });

            stream.on('end', function() {
                callback();
            });
        } catch(ex) {
            console.log(ex);
            callback();
        }
    })
}

rasterize(alphabet_upper, 'alphabet_upper');
rasterize(alphabet_lower, 'alphabet_lower');
rasterize(emoji, 'emoji', 'Apple Color Emoji', '10px', 'emojione-apple.ttf');
rasterize(mathamatical_operators, 'mathamatical_operators');
